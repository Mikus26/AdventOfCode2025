function countSplits(input) {
  // input: soit une seule string avec des \n, soit un tableau de lignes
  const rows = Array.isArray(input) ? input : input.trimEnd().split('\n');
  const H = rows.length;
  const W = rows[0].length;

  // Trouver S
  let startRow = -1;
  let startCol = -1;
  for (let r = 0; r < H; r++) {
    const c = rows[r].indexOf('S');
    if (c !== -1) {
      startRow = r;
      startCol = c;
      break;
    }
  }
  if (startRow === -1) {
    throw new Error('No S found in grid');
  }

  let splitCount = 0;

  // Ensemble de faisceaux actifs sous forme de Set de "r,c"
  let active = new Set([`${startRow},${startCol}`]);

  while (active.size > 0) {
    const newActive = new Set();

    for (const pos of active) {
      const [rStr, cStr] = pos.split(',');
      const r = Number(rStr);
      const c = Number(cStr);

      const nr = r + 1;
      if (nr >= H) {
        // Le faisceau sort de la grille
        continue;
      }

      const cell = rows[nr][c];
      if (cell === '.' || cell === 'S') {
        // Continue tout droit
        newActive.add(`${nr},${c}`);
      } else if (cell === '^') {
        // Split: le faisceau courant s'arrÃªte, deux nouveaux apparaissent
        splitCount++;
        if (c - 1 >= 0) {
          newActive.add(`${nr},${c - 1}`);
        }
        if (c + 1 < W) {
          newActive.add(`${nr},${c + 1}`);
        }
      }
    }

    active = newActive;
  }

  return splitCount;
}

// Exemple d'utilisation sur ton input :
const grid = `......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^.....^...................................................................
.............................................................................................................................................
..................................................................^.^.^.^.^..................................................................
.............................................................................................................................................
.................................................................^.^...^...^.................................................................
.............................................................................................................................................
................................................................^.^.^.^.^.^.^................................................................
.............................................................................................................................................
...............................................................^.^.^.^...^...^...............................................................
.............................................................................................................................................
..............................................................^.^.....^.^...^.^..............................................................
.............................................................................................................................................
.............................................................^...^.....^.^.^.^.^.............................................................
.............................................................................................................................................
............................................................^...^.^.^.^...^.^.^.^............................................................
.............................................................................................................................................
...........................................................^.^.^.^...^...^.^...^.^...........................................................
.............................................................................................................................................
..........................................................^.^.^...^.^.^...^.^.^...^..........................................................
.............................................................................................................................................
.........................................................^.^...^.^.^.^.^.^.^.^.^.^.^.........................................................
.............................................................................................................................................
........................................................^.^...^.^.^.^.^.......^...^.^........................................................
.............................................................................................................................................
.......................................................^...^.^...^.^.......^.^...^.^.^.......................................................
.............................................................................................................................................
......................................................^...^.^...^.^...^.^...^.^.^.....^......................................................
.............................................................................................................................................
.....................................................^.^.^.^.^.^...........^.^...^.^...^.....................................................
.............................................................................................................................................
....................................................^.^.^...^.^.^.^.^.^.^...^.^.....^.^.^....................................................
.............................................................................................................................................
...................................................^.^.^.^...^.....^.........^...^...^.^.^...................................................
.............................................................................................................................................
..................................................^.^.^...^...^.^.^...^.^.^.^...^.^.....^.^..................................................
.............................................................................................................................................
.................................................^.^...^.^.^...^...^...^...^.^.^.^.^...^.^.^.................................................
.............................................................................................................................................
................................................^.^.^...........^.^.^.^.^.^.....^.^.^.....^.^................................................
.............................................................................................................................................
...............................................^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...............................................
.............................................................................................................................................
..............................................^...^.^.^.^...^...^.^.^.....^...^.^.^...^.^.^.^.^..............................................
.............................................................................................................................................
.............................................^.^.^.^.....^.^.^.^.^...^.^.^.^.^...^.^...^...^.^.^.............................................
.............................................................................................................................................
............................................^.^.^.^.^.^.....^.^.^...^.^.....^.^.^.....^.^...^...^............................................
.............................................................................................................................................
...........................................^.^.^...^.^.^.^...^.^.^.^.^.......^.^.^.^.^.^...^...^.^...........................................
.............................................................................................................................................
..........................................^.^.^.^...^.^.^.^.^.^.^.^...^.....^...^.^.^...^.^...^.^.^..........................................
.............................................................................................................................................
.........................................^.....^.^.^.^...^.^.^.....^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.........................................
.............................................................................................................................................
........................................^.^.^...^.....^...^.....^.^.^...^.^.^.^...^.^.^.^...^.^.^.^.^........................................
.............................................................................................................................................
.......................................^.^.^.........^...^...^...^.^.^.^...^.^.^.^...^.^.^.^.^...^...^.......................................
.............................................................................................................................................
......................................^.^...^.^.^...^.^.^.^.^.^...^...^.^.^...^.^.^.^...^.....^.......^......................................
.............................................................................................................................................
.....................................^...^.^.^.^.^.^.^.^.^.^.^.^.^...^...........^.^.^.^...^.....^.^.^.^.....................................
.............................................................................................................................................
....................................^.^.^.......^.^...^...^...^.....^.......^.^...^.......^.^.^.^...^.^.^....................................
.............................................................................................................................................
...................................^.^.^.^.^.^.....^.^...^.^.^.^.^...^.^.^...^.^.^.^.^...^...^.^.^.^.^.^.^...................................
.............................................................................................................................................
..................................^.^...^.^.^.^...^.....^...^.......^.^.^.^.^.^.^...^.^...^.^.....^.^.^.^.^..................................
.............................................................................................................................................
.................................^.^.^.^.^.^.^...^.^.....^.^.^.........^.^...^.^...^.....^.^.^.^.^.^...^.^.^.................................
.............................................................................................................................................
................................^...^.^.....^...^.^.^.^...^.^...^.^.^...^...^.^.^.^.^.^.^.....^.^.^...^.....^................................
.............................................................................................................................................
...............................^.....^...^...^.^.^...^.^.......^.^.^...^.^.^...^.^.^.^...^.^.^.^.^.^.....^...^...............................
.............................................................................................................................................
..............................^.^.^...^...^.....^.^.^.^.^.^...^.^...^...^...^.^.^.^.^.^.^...^.^.^.^...^.^.....^..............................
.............................................................................................................................................
.............................^.^.^.^...^.^...^.^...^...^.^...^.^.^.^...^.....^...^.^.^.......^.^.^...^...^.....^.............................
.............................................................................................................................................
............................^.....^...^...^.^.^.^.^.....^.^.^.^.^.......^.^.^.........^...........^.^.^...^.....^............................
.............................................................................................................................................
...........................^.^.^...^...^.^.....^.^.^.^.^.^.^.^.....^.^.^.^.^.^.^...^.....^.^...^.^.....^.^.^.^...^...........................
.............................................................................................................................................
..........................^.^.^.^.^...^.^.........^.^.^.^.....^...^.^.....^.^.^.^.^.^...^.....^...^.^.^.^...^.....^..........................
.............................................................................................................................................
.........................^...^.^...^.^.^.^...^...^...^...^.^...^.^.^.^.^.^.^...^.^.^.^...^.^.^.^.^.^...^.....^...^.^.........................
.............................................................................................................................................
........................^.^.^...^.^.^.......^...^.^.^.^.^.^...^.^.^...^...^.^.^...^.^.^...^.^.^.^...^...^.^.^.^.^.^.^........................
.............................................................................................................................................
.......................^...^...^.^.^.....^.^.....^.....^.^.^...^.^.......^.^.^.....^...^.^.....^.^.^.^.....^.^.^...^.^.......................
.............................................................................................................................................
......................^.......^.^.^...^.^...^.^...^.^.^.^.....^.^.^.^.^...^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.....^.^...^......................
.............................................................................................................................................
.....................^.^.^.^.^.^.^.^.^...^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...^.^.^...^.^.^.^.^.^.^...^.^.^.^.....................
.............................................................................................................................................
....................^.^...^.....^.^.^.^...^.^.^...^.^.^.^...^.^...^.^.^.....^.....^.^.^...^.^.^...^...^...^.^...^.^...^.^....................
.............................................................................................................................................
...................^.^.^.^.^.^.^...^.^...^.^.^.^...^.^.^.^.....^...^.^.^.^...^.^.^.^.^.^.......^.^...^.^.^.^.....^.^...^.^...................
.............................................................................................................................................
..................^.^.^...^.^...^...^.^.^.........^...^.^.^.^.^.^.^.^.^.^.....^.^...^...^.^.^.......^...^.....^...^.^.^...^..................
.............................................................................................................................................
.................^.^.^.^...^.^.^...^...^...^...^.^.^.^.......^.^.^.^.....^...^.^.^.^...^.^...^.^...^.....^.^.^.^.^.^.......^.................
.............................................................................................................................................
................^.^.....^...^.^.^...^.......^.^.^.^...^.^...^.^.^.^.^.^.^.......^...^...^...^...^.^...^...^...^...^.^.^.^.^.^................
.............................................................................................................................................
...............^.^.....^.....^.^.^.^.^.^...^.^...^.^.^.^.....^.^.^.^.^...^...^.^.^.......^.^.^.^.^...^.^...^...^.^.^.^.^.^...^...............
.............................................................................................................................................
..............^.^...^...^...^.^.^...^...^...^...^.^...^.^.^.^.^...^.^.^.^.^.^.^.^...^.^.......^.....^.........^.^.^.^.^.^.^.^.^..............
.............................................................................................................................................
.............^.^.^.^.^...^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^...^.^.^.^.......^...^.^...^.^.^.^.^.....^.^.^...^.............
.............................................................................................................................................
............^.....^.^.^.^.^.^.^.^.^.....^.^...^...^...^.^.^.^.........^.^.^.....^...^.^...^.^.^.....^.^.^.^.^...^.....^.^.^...^.^............
.............................................................................................................................................
...........^.....^.^...^.^...^.^.^.^...^...^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.......^.^.^.^.^...^.^.^.^.....^.^.^...........
.............................................................................................................................................
..........^...^.^...^.^.^.^.^.^.^...^.^...^.^.^...^...^.^.^.....^.^.^.......^.^.^.^...^.^.^...^.^.^.^.^.^...^.^.....^...^...^.^...^..........
.............................................................................................................................................
.........^.^.^.^...^.^.^.....^.^...^.^.......^.^.....^.^.^.^.^.....^.^...^...^.^.^.......^.^.^.^.^...^.......^.^...^.^...^.^.^...^.^.........
.............................................................................................................................................
........^.^.....^.....^.^...^.^.....^.^...^.....^.^...^.^...^.^...^...^...^.^...^.^.^...^...^.^.....^.^.^.^.^.^.^...^.^.^.^...^.^.^.^........
.............................................................................................................................................
.......^.^.^...^.^.^.^.^...^...^...^.^.^.^.^.....^.^.^.^.^.^.^.^...^.^.^.^.^.^...^.^...^.^.......^.^.^.....^.^.^.^.^...^.....^.^...^.^.......
.............................................................................................................................................
......^.^.....^.^...^.^.^.^.^.....^...^...^.....^.^...^.^.......^.^.^.......^.....^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^...^...^.^...^.^.^.^......
.............................................................................................................................................
.....^.^.^.^.^...^...^.^.^...^.^.....^.^...^.......^.^.^...^.^...^.^.^.^.....^...^.^.^...^.^.^.^.....^.^.^.....^...^.^.^.^.^.^.^.^.^...^.....
.............................................................................................................................................
....^.^.^.^.^.^.^.^.^.........^.^...^.^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.^.^...^.^.^.^.^.^...^.^.^...^.^.^...^...^.^...^.^.^.^.^.^...^.^.^....
.............................................................................................................................................
...^...^.....^...^.^.^.^.^...^.....^...^.^...^.^.^.^.^.^...^.^...^.^.^...^.^.^.^.^...^.^.^.^...^.^.^.^.^.^.^.........^.^...^.^.^.^.^.^.^.^...
.............................................................................................................................................
..^.....^.^.......^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.....^.^.^...^.....^.^.^...^.^.^.^.........^.^.....^.....^.^.^..
.............................................................................................................................................
.^.^.^...^.^...^.^.^...^...^...^.....^.^...^.^...^.^.^...^...^.^...^...^.....^.....^.^.^...^.^.^.....^...^...^.^.^.^.^.^.....^.^.^.......^.^.
.............................................................................................................................................`;

console.log(countSplits(grid)); // 1619
